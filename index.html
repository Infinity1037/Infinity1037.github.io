<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" id="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- 预连接 Firebase 加速加载 -->
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://shared-cat-default-rtdb.asia-southeast1.firebasedatabase.app" crossorigin>
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <title>Yian的猫</title>
    <meta name="description" content="Yian的猫咪虚拟宠物，和朋友一起养猫~">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🐱</text></svg>">
    <meta property="og:title" content="Yian的猫">
    <meta property="og:description" content="和朋友一起养一只虚拟猫咪~">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://changle.me">
    <link rel="stylesheet" href="style.css?v=20260213154647">
</head>

<body>
    <noscript>
        <div style="display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;font-size:1.2rem;text-align:center;padding:2rem;background:#667eea;">
            请启用 JavaScript 来访问 Yian 的猫窝
        </div>
    </noscript>
    <div class="background-overlay"></div>
    <div class="weather-layer" id="weather-layer"></div>
    <div class="particle-layer" id="particle-layer"></div>

    <!-- Auth Screen -->
    <div class="auth-screen" id="auth-screen">
        <div class="auth-content">
            <div class="auth-cat">
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="100" cy="110" r="60" fill="#FFFFFF" opacity="0.3" />
                    <circle cx="100" cy="80" r="55" fill="#FFFFFF" opacity="0.3" />
                    <path d="M60 55 L45 20 L85 45 Z" fill="#FFFFFF" opacity="0.3" />
                    <path d="M140 55 L155 20 L115 45 Z" fill="#FFFFFF" opacity="0.3" />
                </svg>
            </div>
            <div class="auth-title">喵~ 说出暗号</div>
            <div class="auth-input-wrap">
                <input type="password" id="auth-input" class="auth-input" placeholder="悄悄告诉我~" autocomplete="off" inputmode="text" maxlength="32">
            </div>
            <button class="auth-btn" id="auth-btn">进入猫窝</button>
            <div class="auth-error" id="auth-error"></div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen" style="display:none;">
        <div class="loading-content">
            <div class="loading-cat">
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="100" cy="110" r="60" fill="#FFFFFF" opacity="0.3" />
                    <circle cx="100" cy="80" r="55" fill="#FFFFFF" opacity="0.3" />
                    <path d="M60 55 L45 20 L85 45 Z" fill="#FFFFFF" opacity="0.3" />
                    <path d="M140 55 L155 20 L115 45 Z" fill="#FFFFFF" opacity="0.3" />
                </svg>
            </div>
            <div class="loading-text" id="loading-text">正在连接</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
            <button class="retry-btn" id="retry-btn">点击重试</button>
        </div>
    </div>

    <main class="container" id="main-content" style="opacity: 0;">
        <div class="greeting-box">
            <!-- 顶部：问候 + 时间 -->
            <div class="top-bar">
                <div class="top-left">
                    <h1 id="greeting">早上好</h1>
                    <p class="subtitle">愿咪拥有美好的一天</p>
                </div>
                <div class="top-right">
                    <div class="top-time" id="time">00:00</div>
                    <div class="top-date" id="date"></div>
                </div>
            </div>

            <div class="cat-area">
                <!-- 接鱼小游戏容器 -->
                <div class="fish-pond" id="fish-pond"></div>

                <!-- 猫咪对话 -->
                <div class="cat-speech" id="cat-speech">今天心情不错~</div>

                <!-- 猫咪 -->
                <div class="cat-wrapper">
                    <div class="cat-static" id="cat">
                        <svg class="cat-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="110" r="60" fill="#FFFFFF" />
                            <circle cx="100" cy="80" r="55" fill="#FFFFFF" />
                            <path d="M60 55 L45 20 L85 45 Z" fill="#FFFFFF" />
                            <path d="M140 55 L155 20 L115 45 Z" fill="#FFFFFF" />
                            <path d="M62 53 L52 28 L82 47 Z" fill="#FFB7B2" />
                            <path d="M138 53 L148 28 L118 47 Z" fill="#FFB7B2" />
                            <g id="eyes-normal" class="eye">
                                <circle cx="80" cy="80" r="6" fill="#333" />
                                <circle cx="120" cy="80" r="6" fill="#333" />
                            </g>
                            <g id="eyes-happy" style="display:none;" class="eye">
                                <path d="M74 80 Q80 75 86 80" fill="none" stroke="#333" stroke-width="3"
                                    stroke-linecap="round" />
                                <path d="M114 80 Q120 75 126 80" fill="none" stroke="#333" stroke-width="3"
                                    stroke-linecap="round" />
                            </g>
                            <g id="eyes-sad" style="display:none;">
                                <path d="M74 82 Q80 87 86 82" fill="none" stroke="#333" stroke-width="3"
                                    stroke-linecap="round" />
                                <path d="M114 82 Q120 87 126 82" fill="none" stroke="#333" stroke-width="3"
                                    stroke-linecap="round" />
                            </g>
                            <g id="eyes-sleep" style="display:none;">
                                <line x1="74" y1="80" x2="86" y2="80" stroke="#333" stroke-width="3" stroke-linecap="round" />
                                <line x1="114" y1="80" x2="126" y2="80" stroke="#333" stroke-width="3" stroke-linecap="round" />
                            </g>
                            <path d="M95 95 Q100 100 105 95" fill="none" stroke="#333" stroke-width="4"
                                stroke-linecap="round" />
                            <ellipse cx="65" cy="95" rx="8" ry="4" fill="#FFB7B2" opacity="0.7" />
                            <ellipse cx="135" cy="95" rx="8" ry="4" fill="#FFB7B2" opacity="0.7" />
                            <ellipse cx="70" cy="170" rx="12" ry="10" fill="#FFFFFF" />
                            <ellipse cx="130" cy="170" rx="12" ry="10" fill="#FFFFFF" />
                            <path d="M160 140 Q180 135 170 115 Q160 100 140 120" fill="none" stroke="#FFFFFF"
                                stroke-width="12" stroke-linecap="round" />
                        </svg>
                        <div class="cat-accessory" id="cat-accessory"></div>
                        <div class="meow-bubble" id="meow-bubble">喵~</div>
                    </div>
                    <button class="accessory-btn" id="accessory-btn" title="装扮">🎀</button>
                </div>

                <!-- 属性条 -->
                <div class="stats-simple">
                    <div class="stat-item" id="hunger-row">
                        <span class="stat-icon">🍖</span>
                        <div class="stat-bar">
                            <div class="stat-fill hunger" id="hunger-fill"></div>
                        </div>
                        <span class="stat-num" id="hunger-num">80%</span>
                    </div>
                    <div class="stat-item" id="mood-row">
                        <span class="stat-icon">💖</span>
                        <div class="stat-bar">
                            <div class="stat-fill mood" id="mood-fill"></div>
                        </div>
                        <span class="stat-num" id="mood-num">70%</span>
                    </div>
                    <div class="stat-item" id="energy-row">
                        <span class="stat-icon">⚡</span>
                        <div class="stat-bar">
                            <div class="stat-fill energy" id="energy-fill"></div>
                        </div>
                        <span class="stat-num" id="energy-num">60%</span>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="cat-actions">
                    <button class="action-btn feed-btn" id="feed-btn">
                        <span class="btn-icon">🐟</span>
                        <span class="btn-text">喂食</span>
                    </button>
                    <button class="action-btn pet-btn" id="pet-btn">
                        <span class="btn-icon">🖐️</span>
                        <span class="btn-text">抚摸</span>
                    </button>
                    <button class="action-btn play-btn" id="play-btn">
                        <span class="btn-icon">🧶</span>
                        <span class="btn-text">玩耍</span>
                    </button>
                </div>
                <div class="food-menu" id="food-menu"></div>

                <!-- 快捷信息卡片 -->
                <div class="quick-cards">
                    <div class="quick-card love-card" data-panel="love-panel">
                        <div class="qc-icon">💕</div>
                        <div class="qc-content">
                            <div class="qc-label">在一起</div>
                            <div class="qc-value"><span id="love-days">0</span> 天</div>
                        </div>
                    </div>
                    <div class="quick-card" data-panel="fortune-panel">
                        <div class="qc-icon">🔮</div>
                        <div class="qc-content">
                            <div class="qc-label">今日运势</div>
                            <div class="qc-value" id="fortune-mini">去抽签</div>
                        </div>
                    </div>
                    <div class="quick-card" data-panel="quest-panel">
                        <div class="qc-icon">📋</div>
                        <div class="qc-content">
                            <div class="qc-label">今日任务</div>
                            <div class="qc-value" id="quest-mini">查看</div>
                        </div>
                    </div>
                    <div class="quick-card" data-panel="cat-panel">
                        <div class="qc-icon">🐱</div>
                        <div class="qc-content">
                            <div class="qc-label">Yian喵档案</div>
                            <div class="qc-value">Lv.<span id="cat-level-mini">1</span></div>
                        </div>
                    </div>
                </div>

                <!-- 情话打字机 -->
                <div class="quote-card" id="quote-card">
                    <div class="quote-deco">🌙</div>
                    <div class="quote-main">
                        <div class="quote-text" id="quote-text"></div>
                        <div class="quote-cursor">|</div>
                    </div>
                    <div class="quote-hint" id="quote-hint">每日一句</div>
                </div>

                <!-- 迷你信息栏 -->
                <div class="mini-info">
                    <span>Lv.<span id="cat-level">1</span></span>
                    <span class="stats-divider">·</span>
                    <span class="partner-status-bar" id="partner-status"><span class="partner-dot"></span> TA不在</span>
                    <span class="stats-divider">·</span>
                    <span>🔥<span id="streak-mini">0</span>天</span>
                </div>
            </div>
        </div>

        <!-- 底部导航栏 -->
        <nav class="bottom-nav" id="bottom-nav">
            <button class="nav-item" data-panel="love-panel">
                <span class="nav-icon">❤️</span>
                <span class="nav-label">恋爱</span>
            </button>
            <button class="nav-item" data-panel="fortune-panel">
                <span class="nav-icon">🔮</span>
                <span class="nav-label">运势</span>
            </button>
            <button class="nav-item" data-panel="quest-panel">
                <span class="nav-icon">📋</span>
                <span class="nav-label">任务</span>
            </button>
            <button class="nav-item" data-panel="chat-panel">
                <span class="nav-icon">💬</span>
                <span class="nav-label">留言</span>
            </button>
            <button class="nav-item" data-panel="whisper-panel">
                <span class="nav-icon">💌</span>
                <span class="nav-label">悄悄话</span>
            </button>
            <button class="nav-item" data-panel="ai-chat-panel">
                <span class="nav-icon">🤖</span>
                <span class="nav-label">聊天</span>
            </button>
            <button class="nav-item" data-panel="cat-panel">
                <span class="nav-icon">🐱</span>
                <span class="nav-label">Yian喵</span>
            </button>
        </nav>
    </main>

    <!-- ===== 功能面板（底部弹出） ===== -->

    <!-- 恋爱面板 -->
    <div class="panel-overlay" id="love-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>
            <div class="panel-title">❤️ 恋爱</div>
            <div class="panel-body">
                <div class="love-container">
                    <div class="love-days"><span class="love-heart">💕</span> 在一起第 <span id="love-days-panel">0</span> 天</div>
                    <div class="love-quote" id="love-quote-panel"></div>
                    <div class="holiday-countdown" id="holiday-countdown-panel"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 运势面板 -->
    <div class="panel-overlay" id="fortune-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>
            <div class="panel-title">🔮 今日运势</div>
            <div class="panel-body">
                <div class="fortune-container" id="fortune-container">
                    <div class="fortune-card" id="fortune-card">
                        <span class="fortune-icon">✨</span>
                        <span class="fortune-text" id="fortune-text">点击抽取今日运势</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 任务面板 -->
    <div class="panel-overlay" id="quest-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>
            <div class="panel-title">📋 今日任务</div>
            <div class="panel-body">
                <div class="quest-container">
                    <div class="quest-list" id="quest-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 留言面板 -->
    <div class="panel-overlay" id="chat-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>
            <div class="panel-title">💬 留言板</div>
            <div class="panel-body">
                <div class="msg-list" id="msg-list">
                    <div class="msg-empty">还没有留言~</div>
                </div>
            </div>
            <div class="panel-input-bar">
                <input type="text" id="msg-input" class="panel-input" placeholder="说点什么~" maxlength="30" autocomplete="off">
                <button class="panel-send-btn" id="msg-send">发送</button>
            </div>
        </div>
    </div>

    <!-- 猫咪面板 -->
    <div class="panel-overlay" id="cat-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>
            <div class="panel-title">🐱 Yian喵</div>
            <div class="panel-body">
                <div class="panel-section" style="border-top:none;">
                    <div class="streak-row" id="streak-row">
                        <span class="streak-flame">🔥</span>
                        <span>连续签到 <span id="streak-count">0</span> 天</span>
                    </div>
                </div>
                <div class="panel-section">
                    <div class="stats-row">
                        <span>喂食 <span id="total-feeds">0</span></span>
                        <span class="stats-divider">·</span>
                        <span>互动 <span id="total-pets">0</span></span>
                        <span class="stats-divider">·</span>
                        <span>玩耍 <span id="total-plays">0</span></span>
                    </div>
                    <div class="badges-row" id="badges-row"></div>
                </div>
                <div class="panel-section">
                    <div class="cat-diary" id="cat-diary">📖 猫咪还在想今天写什么...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 悄悄话面板 -->
    <div class="panel-overlay" id="whisper-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>
            <div class="panel-title">💌 悄悄话</div>
            <div class="panel-body">
                <div class="whisper-hint">对方下次打开时才能看到哦~</div>
            </div>
            <div class="panel-input-bar">
                <input type="text" id="whisper-input" class="panel-input" placeholder="想对TA说..." maxlength="50" autocomplete="off">
                <button class="panel-send-btn" id="whisper-send">寄出</button>
            </div>
        </div>
    </div>

    <!-- AI聊天面板 -->
    <div class="panel-overlay" id="ai-chat-panel">
        <div class="panel-sheet">
            <button class="panel-close">✕</button>
            <div class="panel-handle"></div>

            <!-- ① 身份选择视图（首屏） -->
            <div id="ai-view-pick" class="ai-view">
                <div class="panel-title">和 Yian喵 聊天</div>
                <div class="ai-nickname-select">
                    <div class="ai-nickname-hint">Yian喵想知道你是谁~</div>
                    <div class="ai-nickname-btns">
                        <button class="ai-nickname-btn" data-nick="源宝"><img src="profile/yuan.jpg" class="ai-nick-avatar"> 我是源宝</button>
                        <button class="ai-nickname-btn" data-nick="咪宝"><img src="profile/mi.jpg" class="ai-nick-avatar"> 我是咪宝</button>
                    </div>
                </div>
            </div>

            <!-- ② 会话列表视图 -->
            <div id="ai-view-list" class="ai-view" style="display:none;">
                <div class="panel-title">
                    <button class="ai-back-btn" id="ai-back-list">←</button>
                    聊天记录
                </div>
                <div class="panel-body ai-session-body">
                    <div class="ai-session-list" id="ai-session-list"></div>
                </div>
                <div class="ai-new-chat-bar">
                    <button class="ai-new-chat-btn" id="ai-new-chat-btn">💬 新建聊天</button>
                </div>
            </div>

            <!-- ③ 聊天视图 -->
            <div id="ai-view-chat" class="ai-view" style="display:none;">
                <div class="panel-title">
                    <button class="ai-back-btn" id="ai-back-chat">←</button>
                    <span id="ai-chat-title">和 Yian喵 聊天</span>
                    <button class="ai-chat-clear-btn" id="ai-chat-clear" title="删除此对话">🗑️</button>
                </div>
                <div class="panel-body ai-chat-body" id="ai-chat-body">
                    <div class="ai-chat-loading hidden" id="ai-chat-loading">加载中...</div>
                    <div class="ai-chat-messages" id="ai-chat-messages"></div>
                </div>
                <div class="panel-input-bar ai-chat-input-bar">
                    <input type="text" id="ai-chat-input" class="panel-input" placeholder="在群里说点什么..." maxlength="200" autocomplete="off">
                    <button class="panel-send-btn" id="ai-chat-send">发送</button>
                </div>
            </div>

        </div>
    </div>

    <!-- AI聊天删除确认弹窗 -->
    <div class="ai-confirm-overlay" id="ai-confirm-overlay">
        <div class="ai-confirm-box">
            <div class="ai-confirm-icon">🗑️</div>
            <div class="ai-confirm-text">确定要删除这段聊天记录吗？</div>
            <div class="ai-confirm-sub">删除后将无法恢复</div>
            <div class="ai-confirm-btns">
                <button class="ai-confirm-cancel" id="ai-confirm-cancel">取消</button>
                <button class="ai-confirm-delete" id="ai-confirm-delete">删除</button>
            </div>
        </div>
    </div>

    <!-- 悄悄话弹窗（收到时） -->
    <div class="whisper-popup" id="whisper-popup">
        <div class="whisper-popup-inner">
            <div class="whisper-popup-header">💌 你收到一封悄悄话</div>
            <div class="whisper-popup-text" id="whisper-popup-text"></div>
            <button class="whisper-popup-btn" id="whisper-popup-close">知道啦~</button>
        </div>
    </div>

    <!-- 随机事件弹窗 -->
    <div class="event-popup" id="event-popup">
        <span class="event-icon" id="event-icon">🦋</span>
        <span class="event-text" id="event-text"></span>
    </div>

    <!-- 成就解锁弹窗 -->
    <div class="badge-popup" id="badge-popup">
        <div class="badge-popup-icon"></div>
        <div class="badge-popup-label">成就解锁!</div>
        <div class="badge-popup-name"></div>
    </div>

    <!-- 双人互动提示 -->
    <div class="action-toast" id="action-toast"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js" defer></script>
    <script src="script.js?v=20260213154647" defer></script>
</body>

</html>